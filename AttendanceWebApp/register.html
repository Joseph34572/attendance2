<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Register – NFC Attendance</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="container">
  <div class="logo"><h1>👤 Student Registration</h1><p id="regSheetName"></p></div>
  <form id="regForm">
    <div class="form-group"><label>Name</label><input id="studentName" type="text" required></div>
    <button type="button" class="btn" id="scanBtn">📱 Scan NFC Card</button>
    <div id="nfcStatus" class="scan-status hidden"></div>
    <div id="regError" class="error hidden"></div>
  </form>
  <div class="toggle-link" onclick="location.href=`sheet.html?id=${new URLSearchParams(location.search).get('id')}`">← Back to Sheet</div>

  <script src="app.js"></script>
  <script>
    const sid = new URLSearchParams(location.search).get('id');
    if (!Auth.currentUser) location.href='login.html';
    const sheet = Sheet.get(sid);
    regSheetName.textContent = sheet.name;
    scanBtn.onclick = async ()=>{
      if(!studentName.value.trim()) return alert('Enter name first');
      nfcStatus.textContent='Hold phone near NFC...';
      nfcStatus.className='scan-status status-scanning';
      regError.classList.add('hidden');
      try {
        const uid = await NFC.scan();
        sheet.students.push({ name: studentName.value.trim(), uid, attendance:{} });
        Sheet.update(sheet);
        nfcStatus.textContent=`✅ ${studentName.value.trim()} registered!`;
        nfcStatus.className='scan-status status-success';
        studentName.value='';
        setTimeout(()=>nfcStatus.classList.add('hidden'),3000);
      } catch(e){
        nfcStatus.textContent=`❌ ${e.message}`;
        nfcStatus.className='scan-status status-error';
        regError.textContent=e.message;
        regError.classList.remove('hidden');
      }
    };
  </script>
</body>
</html>
